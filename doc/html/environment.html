<p>
Within the FreeBSD Perforce repository, there is a TESLA branch located at
<code>//depot/projects/ctsrd/tesla/src</code>.
</p>

<p>
To build the FreeBSD base system with TESLA instrumentation, you will first
need to either:
</p>

<ul>
<li><a href="build.html#install">install TESLA</a> or</li>
<li>set a number of environmental variables.</li>
</ul>

<p>
With sh/bash/zsh, set:
</p>

<div class="console">export TESLA_SOURCE_DIR=/path/to/tesla
export TESLA_BUILD_DIR=<span class="green">$TESLA_SOURCE_DIR</span>/build     <span class="blue"># or wherever you ran cmake</span>
export PATH=<span class="green">$TESLA_SOURCE_DIR</span>/scripts:<span class="green">$PATH</span>
export LLVM_BIN=<span class="green">$LLVM_BUILD_DIR</span>/bin
</div>

<p>
Or in csh/tcsh:
</p>

<div class="console">setenv TESLA_SOURCE_DIR /path/to/tesla
setenv TESLA_BUILD_DIR <span class="green">$TESLA_SOURCE_DIR</span>/build     <span class="blue"># or wherever you ran cmake</span>
setenv PATH <span class="green">$TESLA_SOURCE_DIR</span>/scripts:<span class="green">$PATH</span>
setenv LLVM_BIN <span class="green">$LLVM_BUILD_DIR</span>/bin
</div>

<p>
Then, with either TESLA installed or with the above environmental variables
set, run make in the FreeBSD source tree with the following variables:
</p>

<div class="console">CONFIGARGS=-t -DNO_MODULES -DWITHOUT_FORMAT_EXTENSIONS \
    XCC=<span class="green">$LLVM_BIN</span>/clang \
    XCXX=<span class="green">$LLVM_BIN</span>/clang++ \
    XCPP=<span class="green">$LLVM_BIN</span>/clang-cpp \
    XLLC=<span class="green">$LLVM_BIN</span>/llc \
    TESLA=<span class="green">$TESLA_SOURCE_DIR</span>/scripts/tesla \
    KERNCONF=TESLA
</div>

<p>
After the build is complete, there will be a <code>kernel.instrumented</code>
file alongside <code>kernel</code> in
<code><span class="keyword">$OBJDIR</span>/sys/TESLA</code>.
</p>
