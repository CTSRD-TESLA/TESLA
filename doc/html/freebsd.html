<p>
Within the FreeBSD Perforce repository, there is a TESLA branch located at
<code>//depot/projects/ctsrd/tesla/src</code>.
</p>

<p>
To build the FreeBSD base system with TESLA instrumentation, first
<a href="environment.html">set up your environment</a>, then move some
LLVM-generated headers out of the way to prevent conflicts with FreeBSD system
ones:
</p>

<div class="console">cd <span class="green">$LLVM_BUILD_DIR</span>/lib/clang/3.3
mkdir unsafe
mv *.h unsafe/
mv unsafe/*intrin*.h unsafe/mm3dnow.h unsafe/mm_malloc.h .
</div>

<p>
Then run make in the FreeBSD source tree with the following variables:
</p>

<div class="console">-D WITH_TESLA -D WITHOUT_FORMAT_EXTENSIONS \
    XCC=<span class="green">$LLVM_BIN</span>/clang \
    XCXX=<span class="green">$LLVM_BIN</span>/clang++ \
    XCPP=/usr/bin/clang-cpp \
    XLLC=<span class="green">$LLVM_BIN</span>/llc \
    TESLA=<span class="green">$TESLA_SOURCE_DIR</span>/scripts/tesla \
    KERNCONF=TESLA \
    buildworld buildkernel
</div>

<p>
This will build a instrumented kernel in
<code><span class="keyword">$OBJDIR</span>/sys/TESLA</code>.
</p>
